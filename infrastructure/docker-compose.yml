services:
  # IPFS Node
  ipfs:
    image: ipfs/kubo:latest
    container_name: lairik-ipfs
    ports:
      - "4001:4001"
      - "4001:4001/udp"
      - "5001:5001"
      - "8080:8080"
    volumes:
      - ipfs-data:/data/ipfs
    environment:
      - IPFS_PROFILE=server
      - IPFS_SWARM_KEY=/key/swarm.key
    networks:
      - lairik-network

  # Go Backend Node
  lairik-node:
    build:
      context: ../apps/node
      dockerfile: Dockerfile
    container_name: lairik-node
    ports:
      - "8080:8080"
      - "10000-10100:10000-10100"  # P2P port range
    volumes:
      - node-data:/app/data
    environment:
      - DATA_DIR=/app/data
      - API_PORT=8080
      - P2P_PORT=0
    depends_on:
      - ipfs
    networks:
      - lairik-network

  # Local Database (optional, for testing)
  postgres:
    image: postgres:15-alpine
    container_name: lairik-db
    environment:
      - POSTGRES_USER=lairik
      - POSTGRES_PASSWORD=lairik_pulse_2024
      - POSTGRES_DB=lairik_pulse
    volumes:
      - postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - lairik-network

volumes:
  ipfs-data:
  node-data:
  postgres-data:

networks:
  lairik-network:
    driver: bridge
